import{DisconnectReason as F,makeInMemoryStore as L,makeWASocket as I,useMultiFileAuthState as O}from"@whiskeysockets/baileys";import z from"pino";import{makeCacheableSignalKeyStore as C,proto as M}from"@whiskeysockets/baileys";import u from"pino";var f={author:"https://github.com/zaadevofc",repository:"https://github.com/zaadevofc/zaileys",package:"https://www.npmjs.com/package/zaileys",version:[2,2413,1]};import _ from"node-cache";function h(o){async function e(t){return o.store?(await o.store.loadMessage(t.remoteJid,t.id))?.message||void 0:M.Message.fromObject({})}return{printQRInTerminal:!o.pairing,defaultQueryTimeoutMs:0,connectTimeoutMs:6e4,keepAliveIntervalMs:1e4,msgRetryCounterCache:new _,syncFullHistory:!0,mobile:!1,markOnlineOnConnect:!1,generateHighQualityLinkPreview:!0,browser:["Mac OS","chrome","121.0.6167.159"],version:f.version,logger:u({level:"fatal"}),auth:{creds:o.state.creds,keys:C(o.state.keys,u().child({level:"silent",stream:"store"}))},getMessage:e,patchMessageBeforeSending:t=>(!!(t.buttonsMessage||t.templateMessage||t.listMessage)&&(t={viewOnceMessage:{message:{messageContextInfo:{deviceListMetadataVersion:2,deviceListMetadata:{}},...t}}}),t)}}function d(o,e){return setInterval(()=>o(),e)}function K(o,e){return setTimeout(()=>o(),e)}function c(o){return new Promise(e=>setTimeout(e,o))}import y from"cfonts";import S from"ora";import{EventEmitter as T}from"events";var m=new T;function k(o){console.clear(),y.say("Zaileys",{font:"block",colors:["white","green"],letterSpacing:1,lineHeight:1,space:!1,maxLength:"0"}),y.say("          Love this package? help me with donation:        |                https://ko-fi.com/zaadevofc                |",{font:"console",colors:["black"],background:"green",letterSpacing:1,space:!1,maxLength:"0"});let e=S();m.on("conn_msg",t=>{e[t[0]](t[1])}),o.showLogs}import p from"chalk";var w=class{pairing;phoneNumber;showLogs;socket=m;store;state;constructor({pairing:e,phoneNumber:t,showLogs:r}){this.pairing=e??!0,this.phoneNumber=t,this.showLogs=r??!0,this.client()}async client(){k(this);let e=L({logger:z().child({level:"silent",stream:"store"})}),{state:t,saveCreds:r}=await O("session/zaileys");e.readFromFile("session/data.json"),d(async()=>{try{e.writeToFile("session/data.json")}catch{await this.socket.emit("conn_msg",["fail",p.yellow("[DETECTED] session folder has been deleted by the user")]),await c(2e3),await this.socket.emit("conn_msg",["fail",p.yellow("Please rerun the program...")]),await process.exit()}},1e4),this.state=t,this.store=e;let a=I(h(this));if(e.bind(a.ev),this.pairing&&this.phoneNumber&&!t.creds.me&&!a.authState.creds.registered){this.socket.emit("conn_msg",["start","Initialization new session..."]),await c(2e3),this.socket.emit("conn_msg",["start","Creating new pairing code..."]),await c(6e3);let s=await a.requestPairingCode(this.phoneNumber.toString());this.socket.emit("conn_msg",["info",`Connect with pairing code : ${p.green(s)}`])}return a.ev.on("messages.upsert",async s=>{console.log(JSON.stringify(s.messages,null,2)),this.socket.emit("act_message",s.messages)}),a.ev.process(async s=>{if(s["creds.update"]&&await r(),s["connection.update"]){let P=s["connection.update"],{connection:l,lastDisconnect:b,qr:v}=P;if(l=="connecting"&&(this.socket.emit("act_connection","connecting"),this.socket.emit("conn_msg",["start","Connecting to server..."])),v&&this.socket.emit("conn_msg",["warn","Please scan the QR code..."]),l==="close"){this.socket.emit("act_connection","close");let g=b?.error?.output.statusCode!==F.loggedOut;if(g&&(this.socket.emit("conn_msg",["warn","Failed to connect. Waiting for reconnect..."]),this.client()),!g){this.socket.emit("conn_msg",["fail","Failed to connect. Please delete session and try again."]);return}await this.socket.emit("conn_msg",["info","Trying to reconnect..."]),await c(2e3),await this.socket.emit("conn_msg",["clear"])}l==="open"&&(this.socket.emit("act_connection","ready"),this.socket.emit("conn_msg",["succeed","Connected to server"]),console.log())}}),a}on(e,t){let r=(a,s)=>this.socket.on(`act_${a}`,s);switch(e){case"connection":r(e,t);break;case"message":r(e,t);break;default:break}}};function ge(){}export{w as Client,h as ConnectionConfig,k as InitDisplay,ge as MessageParser,c as delay,d as loop,K as timeOut};
