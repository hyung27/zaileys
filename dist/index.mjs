import{DisconnectReason as U,makeInMemoryStore as W,makeWASocket as Q,useMultiFileAuthState as G}from"@whiskeysockets/baileys";import p from"chalk";import H from"pino";import{makeCacheableSignalKeyStore as N,proto as q}from"@whiskeysockets/baileys";import x from"pino";var w={author:"https://github.com/zaadevofc",repository:"https://github.com/zaadevofc/zaileys",package:"https://www.npmjs.com/package/zaileys",version:[2,2413,1]};import j from"node-cache";function C(s){async function t(e){return s.store?(await s.store.loadMessage(e.remoteJid,e.id))?.message||void 0:q.Message.fromObject({})}return{printQRInTerminal:!s.pairing,defaultQueryTimeoutMs:0,connectTimeoutMs:6e4,keepAliveIntervalMs:1e4,msgRetryCounterCache:new j,syncFullHistory:!0,mobile:!1,markOnlineOnConnect:!1,generateHighQualityLinkPreview:!0,browser:["Mac OS","chrome","121.0.6167.159"],version:w.version,logger:x({level:"fatal"}),auth:{creds:s.state.creds,keys:N(s.state.keys,x().child({level:"silent",stream:"store"}))},getMessage:t,patchMessageBeforeSending:e=>(!!(e.buttonsMessage||e.templateMessage||e.listMessage)&&(e={viewOnceMessage:{message:{messageContextInfo:{deviceListMetadataVersion:2,deviceListMetadata:{}},...e}}}),e)}}var P={text:"text",conversation:"text",imageMessage:"image",contactMessage:"contact",locationMessage:"location",extendedTextMessage:"text",documentMessage:"document",audioMessage:"audio",videoMessage:"video",protocolMessage:"protocol",contactsArrayMessage:"contactsArray",highlyStructuredMessage:"highlyStructured",sendPaymentMessage:"sendPayment",liveLocationMessage:"liveLocation",requestPaymentMessage:"requestPayment",declinePaymentRequestMessage:"declinePaymentRequest",cancelPaymentRequestMessage:"cancelPaymentRequest",templateMessage:"template",stickerMessage:"sticker",groupInviteMessage:"groupInvite",templateButtonReplyMessage:"templateButtonReply",productMessage:"product",deviceSentMessage:"deviceSent",listMessage:"list",viewOnceMessage:"viewOnce",orderMessage:"order",listResponseMessage:"listResponse",ephemeralMessage:"ephemeral",invoiceMessage:"invoice",buttonsMessage:"buttons",buttonsResponseMessage:"buttonsResponse",paymentInviteMessage:"paymentInvite",interactiveMessage:"interactive",reactionMessage:"reaction",stickerSyncRmrMessage:"stickerSyncRmr",interactiveResponseMessage:"interactiveResponse",pollCreationMessage:"pollCreation",pollUpdateMessage:"pollUpdate",keepInChatMessage:"keepInChat",documentWithCaptionMessage:"documentWithCaption",requestPhoneNumberMessage:"requestPhoneNumber",viewOnceMessageV2:"viewOnce",encReactionMessage:"encReaction",editedMessage:"edited",viewOnceMessageV2Extension:"viewOnce",pollCreationMessageV2:"pollCreation",scheduledCallCreationMessage:"scheduledCallCreation",groupMentionedMessage:"groupMentioned",pinInChatMessage:"pinInChat",pollCreationMessageV3:"pollCreation",scheduledCallEditMessage:"scheduledCallEdit",ptvMessage:"ptv",botInvokeMessage:"botInvoke",callLogMesssage:"callLog",encCommentMessage:"encComment",bcallMessage:"bcall",lottieStickerMessage:"lottieSticker",eventMessage:"event",commentMessage:"comment",newsletterAdminInviteMessage:"newsletterAdminInvite",extendedTextMessageWithParentKey:"text",placeholderMessage:"placeholder",encEventUpdateMessage:"encEventUpdate"};function f(s){if(typeof s!="object"||s===null)return[];for(let t of Object.keys(s))if(Object.keys(P).includes(t))return[P[t],t];for(let t of Object.values(s)){let e=f(t);if(e)return e}return[]}function S(s,t){return setInterval(s,t)}function d(s){return JSON.stringify(s??{},null,2)}function D(s){return JSON.parse(d(s))}function ae(s,t){return setTimeout(s,t)}async function M(s){return new Promise(t=>setTimeout(t,s))}var T=async(s,t)=>await fetch(s).then(e=>e.json()),ie=async(s,t)=>await fetch(s,{body:JSON.stringify(t),method:"POST"}).then(e=>e.json());function g(s,t){let e=[],o=n=>{n!=null&&(Array.isArray(n)?n.forEach(o):typeof n=="object"&&Object.entries(n).forEach(([r,a])=>{t.includes(r)&&e.push(a),o(a)}))};return o(s),e}function I(s,t){let e=o=>{if(o===null||typeof o!="object")return o;if(Array.isArray(o))return o.map(e);let n={};for(let r in o)t.includes(r)||(n[r]=e(o[r]));return n};return e(D(s))}import R from"cfonts";import V from"ora";import{EventEmitter as J}from"events";import F from"quick-lru";var O=new F({maxSize:9999999999}),y=new J;import $ from"chalk";function _(s){console.clear(),R.say("Zaileys",{font:"block",colors:["white","green"],letterSpacing:1,lineHeight:1,space:!1,maxLength:"0"}),R.say("         Love this package? help me with donation:         |               https://ko-fi.com/zaadevofc                 |",{font:"console",colors:["black"],background:"green",letterSpacing:1,space:!1,maxLength:"0"});let t=V();y.on("conn_msg",e=>{t[e[0]](e[1]),e[0]=="succeed"&&(O.set("conn_status",e[0]),y.on("conn_config",o=>{o?.forEach((n,r)=>{console.log(n)}),s.showLogs&&console.log($`{cyan — Realtime Logs =>}\n`)}))}),s.showLogs&&y.on("act_msg",e=>{console.log({data:e})})}function z(s,t){return s.map((o,n)=>{let r=Number(o.key.remoteJid?.split("@")[0]);console.log(d(o));let a=I(o,["contextInfo"]),i=g(o,["quotedMessage"])[0],m=f(a),v=g(a,["conversation","text","caption","contentText","description"])[0],u=f(i),b=g(i,["conversation","text","caption","contentText","description"])[0],k=m[0]!="text"&&g(a,[m[1]]),h=u[0]!="text"&&g(i,[u[1]])[0];return h=u[0]=="viewOnce"?g(h,f(h))[0]:h,t.store?.loadMessage("6289526382389@s.whatsapp.net","81AF2468F3C7DD936D771326004D5930").then(E=>{console.log("orang =>>>>  ",E)}),{chatId:o.key.id,fromMe:o.key.fromMe,pushName:o.pushName,remoteJid:o.key.remoteJid,timestamp:o.messageTimestamp,isAuthor:t.authors.includes(r),isBroadcast:o.broadcast,body:{type:m,text:v,isGroup:d(a).includes("@g.us")??!1,isViewOnce:d(a).includes("viewOnce"),media:g(a,[m[1]])},reply:{type:u[0],text:b,isGroup:d(i).includes("@g.us")??!1,isViewOnce:d(i).includes("viewOnce"),media:h}}})}var L={name:"zaileys",description:"Zaileys - Typescript/Javascript WhatsApp NodeJS API",author:{name:"zaadevofc",email:"zaadevofc@gmail.com",url:"https://github.com/zaadevofc"},version:"0.5.1-dev",license:"MIT",main:"dist/index.js",module:"dist/index.mjs",types:"dist/index.d.ts",homepage:"https://github.com/zaadevofc/zaileys",funding:"https://ko-fi.com/zaadevofc",bugs:{url:"https://github.com/zaadevofc/zaileys/issues"},repository:{url:"git+https://github.com/zaadevofc/zaileys.git"},scripts:{build:"tsup","test:dev":"ts-node-dev src/test",test:"ts-node src/test",prod:"tsup && npm publish"},engines:{node:">=18"},keywords:["zaileys","baileys","whatsapp","bot","node","api"],contributors:["zaadevofc@gmail.com"],dependencies:{"@whiskeysockets/baileys":"^6.7.2",cfonts:"^3.2.0",chalk:"^4.1.2",dayjs:"^1.11.11",events:"^3.3.0","link-preview-js":"^3.0.5","log-update":"^3.4.0","node-cache":"^5.1.2",ora:"^5.4.1",pino:"^7.11.0","qrcode-terminal":"^0.12.0","quick-lru":"^5.1.1"},devDependencies:{"@types/node":"^20.13.0",tsup:"^8.0.2",typescript:"^5.4.5"}};var A=class{pairing;phoneNumber;showLogs;authors;socket=y;store;state;me;constructor({pairing:t,phoneNumber:e,showLogs:o,authors:n}){this.pairing=t??!0,this.phoneNumber=e,this.showLogs=o??!0,this.authors=n??[],this.client()}set saveState(t){this.state=t}async client(){_(this);let t=W({logger:H().child({level:"silent",stream:"store"})}),{state:e,saveCreds:o}=await G("session/zaileys");t.readFromFile("session/data.json"),S(async()=>{try{t.writeToFile("session/data.json")}catch{await this.socket.emit("conn_msg",["fail",p.yellow("[DETECTED] session folder has been deleted by the user")]),await M(2e3),await this.socket.emit("conn_msg",["fail",p.yellow("Please rerun the program...")]),await process.exit()}},1e4),this.state=e,this.store=t;let n=Q(C(this));if(t.bind(n.ev),this.pairing&&this.phoneNumber&&!e.creds.me&&!n.authState.creds.registered){this.socket.emit("conn_msg",["start","Initialization new session..."]),await M(2e3),this.socket.emit("conn_msg",["start","Creating new pairing code..."]),await M(6e3);let a=await n.requestPairingCode(this.phoneNumber.toString());this.socket.emit("conn_msg",["info",`Connect with pairing code : ${p.green(a)}`])}n.ev.on("messages.upsert",async a=>{this.socket.emit("act_message",a.messages)});let r=await T("https://registry.npmjs.org/-/package/zaileys/dist-tags");return n.ev.process(async a=>{if(a["creds.update"]){let i=a["creds.update"];i&&r&&this.socket.emit("conn_config",[p`{greenBright → Login as       :} {redBright ${i.me?.verifiedName||i.me?.name}}`,p`{greenBright → Login Method   :} {cyanBright ${i.pairingCode?"Pairing Code":"QR Code"}}`,p`{greenBright → Login Platform :} {cyanBright ${i.platform}}`,p`{greenBright → Creds Phone    :} {magentaBright ${i.phoneId}}`,p`{greenBright → Creds Device   :} {magentaBright ${i.deviceId}}`,p`{greenBright → Libs Current   :} {yellowBright zaileys-${L.version}}`,p`{greenBright → Libs Latest    :} {yellowBright zaileys-${r?.latest}}`,""]),await o()}if(a["connection.update"]){let i=a["connection.update"],{connection:m,lastDisconnect:v,qr:u}=i;if(m=="connecting"&&(this.socket.emit("act_connection","connecting"),this.socket.emit("conn_msg",["start","Connecting to server..."])),u&&this.socket.emit("conn_msg",["warn","Please scan the QR code..."]),m==="close"){this.socket.emit("act_connection","close");let k=v?.error?.output.statusCode!==U.loggedOut;if(k&&(this.socket.emit("conn_msg",["warn","Failed to connect. Waiting for reconnect..."]),this.client()),!k){this.socket.emit("conn_msg",["fail","Failed to connect. Please delete session and try again."]);return}await this.socket.emit("conn_msg",["info","Trying to reconnect..."]),await M(2e3),await this.socket.emit("conn_msg",["clear"])}m==="open"&&(this.socket.emit("act_connection","ready"),this.socket.emit("conn_msg",["succeed","Connected to server"]),console.log())}}),n}on(t,e){let o=(n,r)=>this.socket.on(`act_${n}`,r);switch(t){case"connection":o(t,n=>e(n));break;case"message":o(t,async n=>e(z(n,this)));break;default:break}}};export{A as Client,C as ConnectionConfig,_ as InitDisplay,P as MESSAGE_TYPE,z as MessageParser,M as delay,T as fetchJson,f as getMessageType,g as getValuesByKeys,D as jsonParse,d as jsonString,S as loop,ie as postJson,I as removeKeys,ae as timeout};
