import{DisconnectReason as b,makeInMemoryStore as G,makeWASocket as H,useMultiFileAuthState as Y}from"@whiskeysockets/baileys";import g from"chalk";import Z from"pino";import{makeCacheableSignalKeyStore as $,proto as F}from"@whiskeysockets/baileys";import R from"pino";var S={author:"https://github.com/zaadevofc",repository:"https://github.com/zaadevofc/zaileys",package:"https://www.npmjs.com/package/zaileys",version:[2,2413,1]};import V from"node-cache";function T(t,s){return setInterval(t,s)}function u(t){return JSON.stringify(t??{},null,2)}function C(t){return JSON.parse(u(t))}function ee(t,s){return setTimeout(t,s)}async function k(t){return new Promise(s=>setTimeout(s,t))}var I=async(t,s)=>await fetch(t).then(e=>e.json()),te=async(t,s)=>await fetch(t,{body:JSON.stringify(s),method:"POST"}).then(e=>e.json());function l(t,s){let e=[],o=n=>{n!=null&&(Array.isArray(n)?n.forEach(o):typeof n=="object"&&Object.entries(n).forEach(([a,i])=>{s.includes(a)&&e.push(i),o(i)}))};return o(t),e}function O(t,s){let e=o=>{if(o===null||typeof o!="object")return o;if(Array.isArray(o))return o.map(e);let n={};for(let a in o)s.includes(a)||(n[a]=e(o[a]));return n};return e(C(t))}function z(t){async function s(e){return t.store?(await t.store.loadMessage(e.remoteJid,e.id))?.message||void 0:F.Message.fromObject({})}return{printQRInTerminal:!t.pairing,defaultQueryTimeoutMs:0,connectTimeoutMs:6e4,keepAliveIntervalMs:1e4,msgRetryCounterCache:new V,syncFullHistory:!0,mobile:!1,markOnlineOnConnect:!1,generateHighQualityLinkPreview:!0,browser:["Mac OS","chrome","121.0.6167.159"],version:S.version,logger:R({level:"fatal"}),auth:{creds:t.state.creds,keys:$(t.state.keys,R().child({level:"silent",stream:"store"}))},getMessage:s,patchMessageBeforeSending:e=>(!!(e.buttonsMessage||e.templateMessage||e.listMessage)&&(e={viewOnceMessage:{message:{messageContextInfo:{deviceListMetadataVersion:2,deviceListMetadata:{}},...e}}}),e)}}var _={text:"text",conversation:"text",imageMessage:"image",contactMessage:"contact",locationMessage:"location",extendedTextMessage:"text",documentMessage:"document",audioMessage:"audio",videoMessage:"video",protocolMessage:"protocol",contactsArrayMessage:"contactsArray",highlyStructuredMessage:"highlyStructured",sendPaymentMessage:"sendPayment",liveLocationMessage:"liveLocation",requestPaymentMessage:"requestPayment",declinePaymentRequestMessage:"declinePaymentRequest",cancelPaymentRequestMessage:"cancelPaymentRequest",templateMessage:"template",stickerMessage:"sticker",groupInviteMessage:"groupInvite",templateButtonReplyMessage:"templateButtonReply",productMessage:"product",deviceSentMessage:"deviceSent",listMessage:"list",viewOnceMessage:"viewOnce",orderMessage:"order",listResponseMessage:"listResponse",ephemeralMessage:"ephemeral",invoiceMessage:"invoice",buttonsMessage:"buttons",buttonsResponseMessage:"buttonsResponse",paymentInviteMessage:"paymentInvite",interactiveMessage:"interactive",reactionMessage:"reaction",stickerSyncRmrMessage:"stickerSyncRmr",interactiveResponseMessage:"interactiveResponse",pollCreationMessage:"pollCreation",pollUpdateMessage:"pollUpdate",keepInChatMessage:"keepInChat",documentWithCaptionMessage:"documentWithCaption",requestPhoneNumberMessage:"requestPhoneNumber",viewOnceMessageV2:"viewOnce",encReactionMessage:"encReaction",editedMessage:"edited",viewOnceMessageV2Extension:"viewOnce",pollCreationMessageV2:"pollCreation",scheduledCallCreationMessage:"scheduledCallCreation",groupMentionedMessage:"groupMentioned",pinInChatMessage:"pinInChat",pollCreationMessageV3:"pollCreation",scheduledCallEditMessage:"scheduledCallEdit",ptvMessage:"ptv",botInvokeMessage:"botInvoke",callLogMesssage:"callLog",encCommentMessage:"encComment",bcallMessage:"bcall",lottieStickerMessage:"lottieSticker",eventMessage:"event",commentMessage:"comment",newsletterAdminInviteMessage:"newsletterAdminInvite",extendedTextMessageWithParentKey:"text",placeholderMessage:"placeholder",encEventUpdateMessage:"encEventUpdate"};function y(t){if(t=C(t),console.log({obj:t}),typeof t!="object"||t===null)return[];for(let s of Object.keys(t))if(Object.keys(_).includes(s))return[_[s],s];for(let s of Object.values(t)){let e=y(s);if(e)return e}return[]}import A from"cfonts";import U from"chalk";import W from"ora";import{EventEmitter as j}from"events";import D from"quick-lru";var L=new D({maxSize:9999999999}),f=new j;function B(t){console.clear(),A.say("Zaileys",{font:"block",colors:["white","green"],letterSpacing:1,lineHeight:1,space:!1,maxLength:"0"}),A.say("         Love this package? help me with donation:         |               https://ko-fi.com/zaadevofc                 |",{font:"console",colors:["black"],background:"green",letterSpacing:1,space:!1,maxLength:"0"});let s=W();f.on("conn_msg",e=>{s[e[0]](e[1]),e[0]=="succeed"&&(L.set("conn_status",e[0]),f.on("conn_config",o=>{o?.forEach((n,a)=>{console.log(n)}),t.showLogs&&console.log(U`{cyan — Realtime Logs =>}\n`)}))}),t.showLogs&&f.on("act_msg",e=>{console.log({data:e})})}function E(t,s){return t.map((o,n)=>{console.log(u(o));let a=O(o.message,["contextInfo"]),i=l(o.message,["quotedMessage"])[0],c=o.key,h=l(o.message,["contextInfo"])[0],x=/\b\d+@\S+\b/g.exec(u(c))?.[0],P=/\b\d+@\S+\b/g.exec(u(h))?.[0],r=y(a);r=r[0]=="viewOnce"?y(l(a,[r[1]])):r;let d=y(i);d=d[0]=="viewOnce"?y(l(a,[d[1]])):d;let q=l(a,["conversation","text","caption","contentText","description"])[0],J=l(i,["conversation","text","caption","contentText","description"])[0],v=r[0]!="text"&&l(a,[r[1]])[0];v=r[0]=="viewOnce"?l(v,y(v))[0]:v;let M=d[0]!="text"&&l(i,[d[1]])[0];return M=d[0]=="viewOnce"?l(M,y(M))[0]:M,{chatId:o.key.id,fromMe:o.key.fromMe,pushName:o.pushName,remoteJid:o.key.remoteJid,timestamp:o.messageTimestamp,body:{type:r[0],text:q,isGroup:u(c).includes("@g.us")??!1,isViewOnce:u(a).includes("viewOnce"),isBroadcast:o.broadcast,isAuthor:x,media:v},reply:i&&{type:d[0],text:J,isGroup:u(h).includes("@g.us")??!1,isViewOnce:u(h).includes("viewOnce"),isAuthor:s.authors.includes(Number(P?.split("@")[0])),media:M}}})}var w="0.25.1-dev";var N=class{pairing;phoneNumber;showLogs;authors;socket=f;store;state;me;constructor({pairing:s,phoneNumber:e,showLogs:o,authors:n}){this.pairing=s??!0,this.phoneNumber=e,this.showLogs=o??!0,this.authors=n??[],this.client()}set saveState(s){this.state=s}async client(){B(this);let s=G({logger:Z().child({level:"silent",stream:"store"})}),{state:e,saveCreds:o}=await Y("session/zaileys");s.readFromFile("session/data.json"),T(async()=>{try{s.writeToFile("session/data.json")}catch{await this.socket.emit("conn_msg",["fail",g.yellow("[DETECTED] session folder has been deleted by the user")]),await k(2e3),await this.socket.emit("conn_msg",["fail",g.yellow("Please rerun the program...")]),await process.exit()}},1e4),this.state=e,this.store=s;let n=H(z(this));if(s.bind(n.ev),this.pairing&&this.phoneNumber&&!e.creds.me&&!n.authState.creds.registered){this.socket.emit("conn_msg",["start","Initialization new session..."]),await k(2e3),this.socket.emit("conn_msg",["start","Creating new pairing code..."]),await k(6e3);let i=await n.requestPairingCode(this.phoneNumber.toString());this.socket.emit("conn_msg",["info",`Connect with pairing code : ${g.green(i)}`])}n.ev.on("messages.upsert",async i=>{this.socket.emit("act_message",i.messages)});let a=await I("https://registry.npmjs.org/-/package/zaileys/dist-tags");return n.ev.process(async i=>{if(i["creds.update"]){let c=i["creds.update"];c&&a&&this.socket.emit("conn_config",[g`{greenBright → Login as       :} {redBright ${c.me?.verifiedName||c.me?.name}}`,g`{greenBright → Login Platform :} {cyanBright ${c.platform}}`,g`{greenBright → Creds Phone    :} {magentaBright ${c.phoneId}}`,g`{greenBright → Creds Device   :} {magentaBright ${c.deviceId}}`,g`{greenBright → Libs Current   :} {yellowBright zaileys-${w}}`,g`{greenBright → Libs Latest    :} {${a?.latest==w?"yellowBright":"magenta"} zaileys-${a?.latest}} {red ${a?.latest==w?"":"new version"}}`,""]),await o()}if(i["connection.update"]){let c=i["connection.update"],{connection:h,lastDisconnect:x,qr:P}=c;if(h=="connecting"&&(this.socket.emit("act_connection","connecting"),this.socket.emit("conn_msg",["start","Connecting to server..."])),P&&this.socket.emit("conn_msg",["warn","Please scan the QR code..."]),h==="close"){this.socket.emit("act_connection","close");let r=x?.error;if(r?.output.statusCode!==b.loggedOut&&(await this.socket.emit("conn_msg",["warn","Failed to connect. Waiting for reconnect..."]),await this.client()),r?.output.statusCode==b.connectionReplaced&&(await this.socket.emit("conn_msg",["fail",g`{redBright Connection was lost because the same session was in use!}`]),await process.exit(0)),r?.output.statusCode==b.loggedOut||r?.output.statusCode==b.badSession){this.socket.emit("conn_msg",["fail","Failed to connect. Please delete session and try again."]);return}await this.socket.emit("conn_msg",["info","Trying to reconnect..."]),await k(2e3),await this.socket.emit("conn_msg",["clear"])}h==="open"&&(this.socket.emit("act_connection","ready"),this.socket.emit("conn_msg",["succeed","Connected to server"]),console.log())}}),n}on(s,e){let o=(n,a)=>this.socket.on(`act_${n}`,a);switch(s){case"connection":o(s,n=>e(n));break;case"message":o(s,async n=>e(E(n,this)));break}}};export{N as Client,z as ConnectionConfig,B as InitDisplay,_ as MESSAGE_TYPE,E as MessageParser,k as delay,I as fetchJson,y as getMessageType,l as getValuesByKeys,C as jsonParse,u as jsonString,T as loop,te as postJson,O as removeKeys,ee as timeout};
