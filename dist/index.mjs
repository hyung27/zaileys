import{DisconnectReason as Y,makeInMemoryStore as Z,makeWASocket as $,useMultiFileAuthState as X}from"baileys";import I from"chalk";import{makeCacheableSignalKeyStore as V,proto as j}from"baileys";import U from"node-cache";import E from"pino";var C={author:"https://github.com/zaadevofc",repository:"https://github.com/zaadevofc/zaileys",package:"https://www.npmjs.com/package/zaileys",version:[2,2413,1],browser:["Mac OS","chrome","121.0.6167.159"]};function R(s,t,o){async function n(e){return o?(await o.loadMessage(e.remoteJid,e.id))?.message||void 0:j.Message.fromObject({})}return{printQRInTerminal:!s.pairing,defaultQueryTimeoutMs:0,connectTimeoutMs:6e4,keepAliveIntervalMs:1e4,msgRetryCounterCache:new U,syncFullHistory:!0,mobile:!1,markOnlineOnConnect:!1,generateHighQualityLinkPreview:!0,browser:C.browser,version:C.version,logger:E({enabled:!1}),auth:{creds:t.creds,keys:V(t.keys,E({enabled:!1}))},getMessage:n,patchMessageBeforeSending:e=>(!!(e.buttonsMessage||e.templateMessage||e.listMessage)&&(e={viewOnceMessage:{message:{messageContextInfo:{deviceListMetadataVersion:2,deviceListMetadata:{}},...e}}}),e)}}var T={text:"text",conversation:"text",imageMessage:"image",contactMessage:"contact",locationMessage:"location",extendedTextMessage:"text",documentMessage:"document",audioMessage:"audio",videoMessage:"video",protocolMessage:"protocol",contactsArrayMessage:"contactsArray",highlyStructuredMessage:"highlyStructured",sendPaymentMessage:"sendPayment",liveLocationMessage:"liveLocation",requestPaymentMessage:"requestPayment",declinePaymentRequestMessage:"declinePaymentRequest",cancelPaymentRequestMessage:"cancelPaymentRequest",templateMessage:"template",stickerMessage:"sticker",groupInviteMessage:"groupInvite",templateButtonReplyMessage:"templateButtonReply",productMessage:"product",deviceSentMessage:"deviceSent",listMessage:"list",viewOnceMessage:"viewOnce",orderMessage:"order",listResponseMessage:"listResponse",ephemeralMessage:"ephemeral",invoiceMessage:"invoice",buttonsMessage:"buttons",buttonsResponseMessage:"buttonsResponse",paymentInviteMessage:"paymentInvite",interactiveMessage:"interactive",reactionMessage:"reaction",stickerSyncRmrMessage:"sticker",interactiveResponseMessage:"interactiveResponse",pollCreationMessage:"pollCreation",pollUpdateMessage:"pollUpdate",keepInChatMessage:"keepInChat",documentWithCaptionMessage:"document",requestPhoneNumberMessage:"requestPhoneNumber",viewOnceMessageV2:"viewOnce",encReactionMessage:"reaction",editedMessage:"text",viewOnceMessageV2Extension:"viewOnce",pollCreationMessageV2:"pollCreation",scheduledCallCreationMessage:"scheduledCallCreation",groupMentionedMessage:"groupMentioned",pinInChatMessage:"pinInChat",pollCreationMessageV3:"pollCreation",scheduledCallEditMessage:"scheduledCallEdit",ptvMessage:"ptv",botInvokeMessage:"botInvoke",callLogMesssage:"callLog",encCommentMessage:"encComment",bcallMessage:"bcall",lottieStickerMessage:"lottieSticker",eventMessage:"event",commentMessage:"comment",newsletterAdminInviteMessage:"newsletterAdminInvite",extendedTextMessageWithParentKey:"text",placeholderMessage:"placeholder",encEventUpdateMessage:"encEventUpdate"};function z(s,t){return setInterval(s,t)}function c(s){return JSON.stringify(s??{},null,2)}function N(s){return JSON.parse(c(s))}function me(s,t){return setTimeout(s,t)}async function P(s){return new Promise(t=>setTimeout(t,s))}var de=async(s,t)=>await fetch(s).then(o=>o.json()),ue=async(s,t)=>await fetch(s,{body:JSON.stringify(t),method:"POST"}).then(o=>o.json());function i(s,t){let o=[],n=e=>{e!=null&&(Array.isArray(e)?e.forEach(n):typeof e=="object"&&Object.entries(e).forEach(([a,r])=>{t.includes(a)&&o.push(r),n(r)}))};return n(s),o}function S(s,t){let o=n=>{if(n===null||typeof n!="object")return n;if(Array.isArray(n))return n.map(o);let e={};for(let a in n)t.includes(a)||(e[a]=o(n[a]));return e};return o(N(s))}function l(s){if(s=N(s),typeof s!="object"||s===null)return[];for(let t of Object.keys(s))if(Object.keys(T).includes(t))return[T[t],t];for(let t of Object.values(s)){let o=l(t);if(o)return o}return[]}import q from"cfonts";import H from"ora";import{EventEmitter as D}from"events";import G from"quick-lru";var we=new G({maxSize:9999999999}),v=new D;var L="https://ko-fi.com/zaadevofc";function _(s){console.clear(),q.say("Zaileys",{font:"block",colors:["white","green"],letterSpacing:1,lineHeight:1,space:!1,maxLength:"0"}),q.say(`         Love this package? help me with donation:         |               ${L}                 |`,{font:"console",colors:["black"],background:"green",letterSpacing:1,space:!1,maxLength:"0"}),v.on("conn_msg",async t=>{let o=H();await o[t[0]](t[1]),await o.clear()}),s.showLogs&&v.on("act_msg",t=>{})}async function J(s,t,o){return s?await Promise.all(s.map(async(e,a)=>{if(l(e.message).length==0||l(e.message)[0]=="protocol"||c(e.message).includes("pollUpdateMessage"))return;let r=S(e.message,["contextInfo"]),p=i(e.message,["quotedMessage"])[0],y=e.key,f=i(e.message,["contextInfo"])[0],b=l(r)[1]=="editedMessage",O=b&&i(e.message,["protocolMessage"])[0].key,k=b&&S(await o.loadMessage(O.remoteJid,O.id),["contextInfo"]);k=S(k.message,["contextInfo"]);let A=/\b\d+@\S+\b/g.exec(i(y,["participant"])[0]||i(y,["remoteJid"])[0])?.[0],w=/\b\d+@\S+\b/g.exec(i(f,["participant"])[0])?.[0],u=l(b?k:r);u=u[0]=="viewOnce"?l(i(r,[u[1]])):u;let g=l(p);g=g[0]=="viewOnce"?l(i(p,[g[1]])):g;let F=i(r,["conversation","text","caption","contentText","description"])[0],K=i(p,["conversation","text","caption","contentText","description"])[0],h=u[0]!="text"&&i(b?k:r,[u[1]=="documentWithCaptionMessage"?"documentMessage":u[1]])[0];h=u[0]=="viewOnce"?i(h,l(h))[0]:h;let M=g[0]!="text"&&i(p,[g[1]=="documentWithCaptionMessage"?"documentMessage":g[1]])[0];M=g[0]=="viewOnce"?i(M,l(M))[0]:M;let x=await o.messages[w].get(i(f,["stanzaId"])[0]);return console.log("\u{1F680} ~ letmessages:any=awaitPromise.all ~ replyJid:",w),console.log("\u{1F680} ~ letmessages:any=awaitPromise.all ~ replyStore:",x),{body:{fromMe:e.key.fromMe,chatId:e.key.id,participant:A,pushName:e.pushName,timestamp:e.messageTimestamp,type:u[0],text:F,isStory:c(y).includes("status@broadcast")??!1,isGroup:c(y).includes("@g.us")??!1,isViewOnce:c(r).includes("viewOnce"),isForwarded:c(e.message).includes("isForwarded"),isEdited:c(r).includes("editedMessage"),isBroadcast:e.broadcast,isAuthor:t.authors.includes(Number(A?.split("@")[0])),media:h},reply:p&&{fromMe:x?.key?.fromMe,chatId:i(f,["stanzaId"])[0],participant:w,pushName:x?.pushName,timestamp:x?.messageTimestamp,type:g[0],text:K,isGroup:c(f).includes("@g.us")??!1,isViewOnce:c(f).includes("viewOnce"),isForwarded:c(e.message).includes("isForwarded"),isAuthor:t.authors.includes(Number(w?.split("@")[0])),media:M}}})):[]}var B=class{pairing;phoneNumber;showLogs;authors;ignoreMe;canNext=!1;socket=v;sock={};constructor({pairing:t,phoneNumber:o,showLogs:n,authors:e,ignoreMe:a}){this.pairing=t??!0,this.phoneNumber=o,this.showLogs=n??!0,this.ignoreMe=a??!1,this.authors=e??[],this.init()}async init(){let t=Z({}),{state:o,saveCreds:n}=await X("session/zaileys");t.readFromFile("session/data.json"),z(async()=>{try{t.writeToFile("session/data.json")}catch{await this.socket.emit("conn_msg",["fail",I.yellow("[DETECTED] session folder has been deleted by the user")]),await P(2e3),await this.socket.emit("conn_msg",["fail",I.yellow("Please rerun the program...")]),await process.exit()}},1e4);let e=$(R(this,o,t));t.bind(e.ev),e.ev.on("creds.update",n),e.ev.on("connection.update",async a=>{let r=_(this),{connection:p,lastDisconnect:y}=a;if(p=="connecting"&&console.log("menghubungkan...."),this.pairing&&this.phoneNumber&&!o.creds.me&&!e.authState.creds.registered){this.socket.emit("conn_msg",["start","Initialization new session..."]),await P(2e3),this.socket.emit("conn_msg",["start","Creating new pairing code..."]),await P(6e3);let f=await e.requestPairingCode(this.phoneNumber.toString());this.socket.emit("conn_msg",["info",`Connect with pairing code : ${I.green(f)}`])}p==="close"?y?.error?.output?.statusCode!==Y.loggedOut&&(console.log("reconecting..."),this.init()):p==="open"&&console.log("koneekk")}),e.ev.process(async a=>{if(a["messages.upsert"]){let r=a["messages.upsert"];console.log(c({msg:r}));let p=await J(r.messages,this,t);if(p.filter(y=>y).length==0)return;await this.socket.emit("messages.upsert",p)}})}async on(t,o){let n=(e,a)=>this.socket.on(e,a);switch(t){case"connection":break;case"message":n("messages.upsert",e=>{e&&o(e)});break}}};export{B as Client,R as ConnectionConfig,_ as InitDisplay,T as MESSAGE_TYPE,J as MessageParser,P as delay,de as fetchJson,l as getMessageType,i as getValuesByKeys,N as jsonParse,c as jsonString,z as loop,ue as postJson,S as removeKeys,me as timeout};
