import{DisconnectReason as V,makeInMemoryStore as z,makeWASocket as K,useMultiFileAuthState as j}from"@whiskeysockets/baileys";import U from"pino";import{makeCacheableSignalKeyStore as A,proto as L}from"@whiskeysockets/baileys";import x from"pino";var P={author:"https://github.com/zaadevofc",repository:"https://github.com/zaadevofc/zaileys",package:"https://www.npmjs.com/package/zaileys",version:[2,2413,1]};import B from"node-cache";function C(o){async function e(s){return o.store?(await o.store.loadMessage(s.remoteJid,s.id))?.message||void 0:L.Message.fromObject({})}return{printQRInTerminal:!o.pairing,defaultQueryTimeoutMs:0,connectTimeoutMs:6e4,keepAliveIntervalMs:1e4,msgRetryCounterCache:new B,syncFullHistory:!0,mobile:!1,markOnlineOnConnect:!1,generateHighQualityLinkPreview:!0,browser:["Mac OS","chrome","121.0.6167.159"],version:P.version,logger:x({level:"fatal"}),auth:{creds:o.state.creds,keys:A(o.state.keys,x().child({level:"silent",stream:"store"}))},getMessage:e,patchMessageBeforeSending:s=>(!!(s.buttonsMessage||s.templateMessage||s.listMessage)&&(s={viewOnceMessage:{message:{messageContextInfo:{deviceListMetadataVersion:2,deviceListMetadata:{}},...s}}}),s)}}var w={text:"text",conversation:"text",imageMessage:"image",contactMessage:"contact",locationMessage:"location",extendedTextMessage:"text",documentMessage:"document",audioMessage:"audio",videoMessage:"video",protocolMessage:"protocol",contactsArrayMessage:"contactsArray",highlyStructuredMessage:"highlyStructured",sendPaymentMessage:"sendPayment",liveLocationMessage:"liveLocation",requestPaymentMessage:"requestPayment",declinePaymentRequestMessage:"declinePaymentRequest",cancelPaymentRequestMessage:"cancelPaymentRequest",templateMessage:"template",stickerMessage:"sticker",groupInviteMessage:"groupInvite",templateButtonReplyMessage:"templateButtonReply",productMessage:"product",deviceSentMessage:"deviceSent",listMessage:"list",viewOnceMessage:"viewOnce",orderMessage:"order",listResponseMessage:"listResponse",ephemeralMessage:"ephemeral",invoiceMessage:"invoice",buttonsMessage:"buttons",buttonsResponseMessage:"buttonsResponse",paymentInviteMessage:"paymentInvite",interactiveMessage:"interactive",reactionMessage:"reaction",stickerSyncRmrMessage:"stickerSyncRmr",interactiveResponseMessage:"interactiveResponse",pollCreationMessage:"pollCreation",pollUpdateMessage:"pollUpdate",keepInChatMessage:"keepInChat",documentWithCaptionMessage:"documentWithCaption",requestPhoneNumberMessage:"requestPhoneNumber",viewOnceMessageV2:"viewOnce",encReactionMessage:"encReaction",editedMessage:"edited",viewOnceMessageV2Extension:"viewOnce",pollCreationMessageV2:"pollCreation",scheduledCallCreationMessage:"scheduledCallCreation",groupMentionedMessage:"groupMentioned",pinInChatMessage:"pinInChat",pollCreationMessageV3:"pollCreation",scheduledCallEditMessage:"scheduledCallEdit",ptvMessage:"ptv",botInvokeMessage:"botInvoke",callLogMesssage:"callLog",encCommentMessage:"encComment",bcallMessage:"bcall",lottieStickerMessage:"lottieSticker",eventMessage:"event",commentMessage:"comment",newsletterAdminInviteMessage:"newsletterAdminInvite",extendedTextMessageWithParentKey:"text",placeholderMessage:"placeholder",encEventUpdateMessage:"encEventUpdate"};function f(o){if(typeof o!="object"||o===null)return[];for(let e of Object.keys(o))if(Object.keys(w).includes(e))return[w[e],e];for(let e of Object.values(o)){let s=f(e);if(s)return s}return[]}function b(o,e){return setInterval(o,e)}function g(o){return JSON.stringify(o??{},null,2)}function N(o){return JSON.parse(g(o))}function ee(o,e){return setTimeout(o,e)}async function h(o){return new Promise(e=>setTimeout(e,o))}function p(o,e){let s=[],t=n=>{n!=null&&(Array.isArray(n)?n.forEach(t):typeof n=="object"&&Object.entries(n).forEach(([r,a])=>{e.includes(r)&&s.push(a),t(a)}))};return t(o),s}function S(o,e){let s=t=>{if(t===null||typeof t!="object")return t;if(Array.isArray(t))return t.map(s);let n={};for(let r in t)e.includes(r)||(n[r]=s(t[r]));return n};return s(N(o))}import T from"cfonts";import F from"ora";import{EventEmitter as q}from"events";import D from"quick-lru";var le=new D({maxSize:9999999999}),M=new q;import he from"chalk";function I(o){console.clear(),T.say("Zaileys",{font:"block",colors:["white","green"],letterSpacing:1,lineHeight:1,space:!1,maxLength:"0"}),T.say("         Love this package? help me with donation:         |               https://ko-fi.com/zaadevofc                 |",{font:"console",colors:["black"],background:"green",letterSpacing:1,space:!1,maxLength:"0"});let e=F();M.on("conn_msg",s=>{e[s[0]](s[1]),s[0]=="succeed"&&M.on("conn_config",t=>{t?.forEach((n,r)=>{console.log(n)})})}),o.showLogs}import m from"chalk";function R(o,e){return o.map((t,n)=>{let r=Number(t.key.remoteJid?.split("@")[0]);console.log(g(t));let a=S(t,["contextInfo"]),l=p(t,["quotedMessage"])[0],u=f(a),k=p(a,["conversation","text","caption","contentText","description"])[0],d=f(l),v=p(l,["conversation","text","caption","contentText","description"])[0],$=u[0]!="text"&&p(a,[u[1]]),y=d[0]!="text"&&p(l,[d[1]])[0];return y=d[0]=="viewOnce"?p(y,f(y))[0]:y,e.store?.loadMessage("6289526382389@s.whatsapp.net","81AF2468F3C7DD936D771326004D5930").then(_=>{console.log("orang =>>>>  ",_)}),{chatId:t.key.id,fromMe:t.key.fromMe,pushName:t.pushName,remoteJid:t.key.remoteJid,timestamp:t.messageTimestamp,isAuthor:e.authors.includes(r),isBroadcast:t.broadcast,body:{type:u,text:k,isGroup:g(a).includes("@g.us")??!1,isViewOnce:g(a).includes("viewOnce"),media:p(a,[u[1]])},reply:{type:d[0],text:v,isGroup:g(l).includes("@g.us")??!1,isViewOnce:g(l).includes("viewOnce"),media:y}}})}var O=class{pairing;phoneNumber;showLogs;authors;socket=M;store;state;me;constructor({pairing:e,phoneNumber:s,showLogs:t,authors:n}){this.pairing=e??!0,this.phoneNumber=s,this.showLogs=t??!0,this.authors=n??[],this.client()}set saveState(e){this.state=e}async client(){I(this);let e=z({logger:U().child({level:"silent",stream:"store"})}),{state:s,saveCreds:t}=await j("session/zaileys");e.readFromFile("session/data.json"),b(async()=>{try{e.writeToFile("session/data.json")}catch{await this.socket.emit("conn_msg",["fail",m.yellow("[DETECTED] session folder has been deleted by the user")]),await h(2e3),await this.socket.emit("conn_msg",["fail",m.yellow("Please rerun the program...")]),await process.exit()}},1e4),this.state=s,this.store=e;let n=K(C(this));if(e.bind(n.ev),this.pairing&&this.phoneNumber&&!s.creds.me&&!n.authState.creds.registered){this.socket.emit("conn_msg",["start","Initialization new session..."]),await h(2e3),this.socket.emit("conn_msg",["start","Creating new pairing code..."]),await h(6e3);let r=await n.requestPairingCode(this.phoneNumber.toString());this.socket.emit("conn_msg",["info",`Connect with pairing code : ${m.green(r)}`])}return n.ev.on("messages.upsert",async r=>{this.socket.emit("act_message",r.messages)}),n.ev.process(async r=>{if(r["creds.update"]){let a=r["creds.update"];this.socket.emit("conn_config",[m`{greenBright → Login as       :} {redBright ${a.me?.verifiedName||a.me?.name}}`,m`{greenBright → Login Method   :} {cyanBright ${this.pairing?"Pairing Code":"QR Code"}}`,m`{greenBright → Login Platform :} {yellowBright ${a.platform}}`,m`{greenBright → Phone Creds    :} {magentaBright ${a.phoneId}}`,m`{greenBright → Device Creds   :} {magentaBright ${a.deviceId}}`,""]),await t()}if(r["connection.update"]){let a=r["connection.update"],{connection:l,lastDisconnect:u,qr:k}=a;if(l=="connecting"&&(this.socket.emit("act_connection","connecting"),this.socket.emit("conn_msg",["start","Connecting to server..."])),k&&this.socket.emit("conn_msg",["warn","Please scan the QR code..."]),l==="close"){this.socket.emit("act_connection","close");let v=u?.error?.output.statusCode!==V.loggedOut;if(v&&(this.socket.emit("conn_msg",["warn","Failed to connect. Waiting for reconnect..."]),this.client()),!v){this.socket.emit("conn_msg",["fail","Failed to connect. Please delete session and try again."]);return}await this.socket.emit("conn_msg",["info","Trying to reconnect..."]),await h(2e3),await this.socket.emit("conn_msg",["clear"])}l==="open"&&(this.socket.emit("act_connection","ready"),this.socket.emit("conn_msg",["succeed","Connected to server"]),console.log())}}),n}on(e,s){let t=(n,r)=>this.socket.on(`act_${n}`,r);switch(e){case"connection":t(e,n=>s(n));break;case"message":t(e,async n=>s(R(n,this)));break;default:break}}};export{O as Client,C as ConnectionConfig,I as InitDisplay,w as MESSAGE_TYPE,R as MessageParser,h as delay,f as getMessageType,p as getValuesByKeys,N as jsonParse,g as jsonString,b as loop,S as removeKeys,ee as timeout};
